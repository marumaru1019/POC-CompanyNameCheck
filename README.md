# README

## 概要
本プロジェクトでは、顧客管理台帳とパートナーセンターのデータを用いて、会社名の表記ゆれを検出し、同一会社として認識できるかを検証しました。ルールベースおよびGPTベースのアプローチを用いて、各種シナリオ（スペースの有無、半角全角の違い、カナ/英字の違い、株式会社の有無、略称、その他）に対する検証を行い、最適なアプローチを導出しました。

## 構成
- **dataset/correct_data**: 正解データを格納しています。
- **dataset/customer_book**: 顧客管理台帳の想定サンプルデータを格納しています。
- **dataset/partner_center**: パートナーセンターの想定サンプルデータを格納しています。
- **result**: 検証結果が保存されます。
- **create_dataset.ipynb**: データセットの中身を作成するためのプログラムです。
- **single_validate_company_name.ipynb**: ルールベースの各パターンごとに個別に検証を実施。また、GPTベースに関しても会社名の1ペアで実施。
- **whole_validate_company_name.ipynb**: データセット全体を対象にした検証を実施するプログラムです。

## 事前準備
1. **Jupyterを使える環境のセットアップ**:
   - 本環境は[こちらのQiita記事](https://qiita.com/fuku_tech/items/6752b00770552bf4f46b)を基に構築されています。
   - 必要なライブラリをインストールし、Jupyter Notebookが動作する環境を準備してください。

2. **Azure OpenAI GPT-4oのモデルをデプロイ**:
   - Azure Portalにアクセスし、OpenAIサービスを利用してGPT-4oモデルをデプロイしてください。

## 実施手順

### 1. Jupyterを使える環境の準備
- 上記の事前準備に従い、Jupyter Notebook環境をセットアップします。

### 2. ライブラリのインストール
以下のコマンドを実行して必要なPythonライブラリをインストールします。
```bash
pip install pandas openai
```

### 3. データセットの作成
- `create_dataset.ipynb`を実行して、データセットを作成します。ただし、既にデータセットがプロジェクトに用意されているため、スキップしても問題ありません。

### 4. 検証の実施
- **個別検証**:
  - `single_validate_company_name.ipynb`を実行して、ルールベースおよびGPTベースで個別の会社名ペアを検証します。
- **全体検証**:
  - `whole_validate_company_name.ipynb`を実行して、データセット全体に対する検証を実施します。

### 環境変数の設定
`single_validate_company_name.ipynb`、`whole_validate_company_name.ipynb`において、**GPT-4o 用の環境変数をセット**というセクションがあります。Azure OpenAI GPT-4oモデルを使用するために、以下の環境変数を設定します。これにより、APIキーやエンドポイントをプログラム内で利用可能にします。
```python
import os
os.environ["AZURE_OPENAI_API_KEY"] = "<Azure OpenAI の API Key>"
os.environ["AZURE_OPENAI_ENDPOINT"] = 'https://<Azure OpenAI のサービス名>.openai.azure.com/'
os.environ["AZURE_DEPLOYMENT_NAME"] = "<Azure OpenAI でデプロイした GPT-4o のデプロイ名>"
```

### GPT-4oで使用しているプロンプトについて
以下のプロンプトを使用して、会社名の表記ゆれを検出し、同一会社として認識できるかを判断しています。
```python
会社名のペアが与えられた際に、表記の違いがあっても同じ会社かどうかを判断し、結果をJSON形式で出力してください。JSONのスキーマは、company_name1, company_name2, similarity_score, description として。考慮するべき違いには、スペース、文字の幅、言語、および略称が含まれますが、他にも様々な表記のパターンが存在することを念頭に置いてください。それぞれの比較について、以下のフォーマットを使用してください：

- 会社名1: <company1>
- 会社名2: <company2>
- 比較結果 (1-5):
- 説明:

比較結果のスコアリングは以下の通りです：
- 5: 絶対に一致している
- 1: 絶対に一致していない
- 2-4: 一致の可能性があるが、自信度によりスコアリング

### 例:

#### 1. スペースの有無
- 会社名1: 九州電子 株式会社
- 会社名2: 九州電子株式会社
- 比較結果: 5
- 説明: 「九州電子」と「株式会社」の間にスペースがあるかないかの違いだけであり、これは一般的な表記の揺れです。

#### 2. 半角全角の違い
- 会社名1: 合同会社All Right
- 会社名2: 合同会社Ａｌｌ　Ｒｉｇｈｔ
- 比較結果: 5
- 説明: 半角と全角文字の違いだけであり、会社の同一性には影響しません。

#### 3. カナ/英字の違い
- 会社名1: 大和ハウス工業 株式会社
- 会社名2: DAIWA HOUSE INDUSTRY CO., LTD.
- 比較結果: 5
- 説明: 日本語名と英語名で表記されているだけであり、国際的な企業では一般的です。

#### 4. 株式会社の有無
- 会社名1: T&Dリスクソリューションズ株式会社
- 会社名2: T&Dリスクソリューションズ
- 比較結果: 5
- 説明: 「株式会社」の有無は法的なデザインエータであり、会社の同一性には影響しません。

#### 5. 略称
- 会社名1: 株式会社福島中央ﾃﾚﾋﾞ
- 会社名2: fct.jp
- 比較結果: 5
- 説明: 一つは正式名称であり、もう一つは会社のドメイン名を使った略称です。

#### 6. その他のバリエーション
- 会社名1: 株式会社M-TEC
- 会社名2: 株式会社MｰTEC本社･工場
- 比較結果: 5
- 説明: 二つ目の名前には本社と工場の情報が含まれていますが、どちらも同じ企業を指しています。

#### 7. 曖昧な例
- 会社名1: 株式会社ヤマト
- 会社名2: ヤマト運輸株式会社
- 比較結果: 4
- 説明: 株式会社ヤマトとヤマト運輸株式会社は関連がある可能性がありますが、正式な名称として異なる場合もあるため、完全に一致しているかは不明です。

- 会社名1: NECソリューションイノベータ株式会社
- 会社名2: NECソリューションズ
- 比較結果: 3
- 説明: NECソリューションイノベータ株式会社とNECソリューションズは関連がある可能性がありますが、同一の会社であるかどうかは完全には確信が持てません。

- 会社名1: 株式会社みずほ銀行
- 会社名2: みずほフィナンシャルグループ
- 比較結果: 3
- 説明: 株式会社みずほ銀行とみずほフィナンシャルグループは関連会社である可能性が高いですが、同一の会社とは限りません。

- 会社名1: パナソニック株式会社
- 会社名2: パナソニックシステムソリューションズジャパン株式会社
- 比較結果: 2
- 説明: パナソニック株式会社とパナソニックシステムソリューションズジャパン株式会社は同じ企業グループ内の別会社である可能性が高いですが、同一の会社ではない可能性があります。

#### 8. 一致しない例
- 会社名1: 東京電力株式会社
- 会社名2: 中部電力株式会社
- 比較結果: 1
- 説明: 東京電力株式会社と中部電力株式会社は別々の企業であり、提供するサービスや所在地も異なります。

- 会社名1: 株式会社三菱
- 会社名2: 三菱商事株式会社
- 比較結果: 1
- 説明: 株式会社三菱と三菱商事株式会社は異なる会社であり、それぞれ異なる事業分野を持っています。

Based on these examples, please evaluate the following pair and output the result in JSON format with the following schema:

    "company_name1": "{company1}",
    "company_name2": "{company2}",
    "similarity_score": <score>,
    "description": "<explanation>"
"""
```

### 結果のカラムの説明
検証が終わると`result`フォルダに結果が保存されます。
`妥当性_predicted`と`妥当性_true`という項目があるので、そちらを確認して予測データと正解データを比較できます(GPTベースの場合、予測データがスコアになっているので注意してください)。
